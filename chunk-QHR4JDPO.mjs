import './polyfills.server.mjs';
import{c as w,f as Y}from"./chunk-YELSAYKL.mjs";var W=Y((ce,V)=>{"use strict";var $=w("url").parse,D=w("events"),ee=w("https"),re=w("http"),te=w("util"),ae=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],Q=[239,187,191],ne=58,se=32,J=10,oe=13,K=1024*256,ie=/^(cookie|authorization)$/i;function fe(a){return Q.every(function(e,r){return a[r]===e})}function s(a,e){var r=s.CONNECTING,h=e&&e.headers,z=!1;Object.defineProperty(this,"readyState",{get:function(){return r}}),Object.defineProperty(this,"url",{get:function(){return a}});var i=this;i.reconnectInterval=1e3,i.connectionInProgress=!1;function j(n){r!==s.CLOSED&&(r=s.CONNECTING,C("error",new P("error",{message:n})),x&&(a=x,x=null,z=!1),setTimeout(function(){r!==s.CONNECTING||i.connectionInProgress||(i.connectionInProgress=!0,I())},i.reconnectInterval))}var u,O="";h&&h["Last-Event-ID"]&&(O=h["Last-Event-ID"],delete h["Last-Event-ID"]);var B=!1,U="",G="",x=null;function I(){var n=$(a),v=n.protocol==="https:";if(n.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},O&&(n.headers["Last-Event-ID"]=O),h){var c=z?ve(h):h;for(var E in c){var N=c[E];N&&(n.headers[E]=N)}}n.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(n.createConnection=e.createConnection);var T=e&&e.proxy;if(T){var l=$(e.proxy);v=l.protocol==="https:",n.protocol=v?"https:":"http:",n.path=a,n.headers.Host=n.host,n.hostname=l.hostname,n.host=l.host,n.port=l.port}if(e&&e.https){for(var p in e.https)if(ae.indexOf(p)!==-1){var _=e.https[p];_!==void 0&&(n[p]=_)}}e&&e.withCredentials!==void 0&&(n.withCredentials=e.withCredentials),u=(v?ee:re).request(n,function(t){if(i.connectionInProgress=!1,t.statusCode===500||t.statusCode===502||t.statusCode===503||t.statusCode===504){C("error",new P("error",{status:t.statusCode,message:t.statusMessage})),j();return}if(t.statusCode===301||t.statusCode===302||t.statusCode===307){var m=t.headers.location;if(!m){C("error",new P("error",{status:t.statusCode,message:t.statusMessage}));return}var S=new URL(a).origin,k=new URL(m).origin;z=S!==k,t.statusCode===307&&(x=a),a=m,process.nextTick(I);return}if(t.statusCode!==200)return C("error",new P("error",{status:t.statusCode,message:t.statusMessage})),i.close();r=s.OPEN,t.on("close",function(){t.removeAllListeners("close"),t.removeAllListeners("end"),j()}),t.on("end",function(){t.removeAllListeners("close"),t.removeAllListeners("end"),j()}),C("open",new P("open"));var o,M,F=0,H=-1,L=0,d=0;t.on("data",function(y){o?(y.length>o.length-d&&(L=o.length*2+y.length,L>K&&(L=o.length+y.length+K),M=Buffer.alloc(L),o.copy(M,0,0,d),o=M),y.copy(o,d),d+=y.length):(o=y,fe(o)&&(o=o.slice(Q.length)),d=o.length);for(var f=0,A=d;f<A;){B&&(o[f]===J&&++f,B=!1);for(var g=-1,q=H,R,b=F;g<0&&b<A;++b)R=o[b],R===ne?q<0&&(q=b-f):R===oe?(B=!0,g=b-f):R===J&&(g=b-f);if(g<0){F=A-f,H=q;break}else F=0,H=-1;Z(o,f,q,g),f+=g+1}f===A?(o=void 0,d=0):f>0&&(o=o.slice(f,d),d=o.length)})}),u.on("error",function(t){i.connectionInProgress=!1,j(t.message)}),u.setNoDelay&&u.setNoDelay(!0),u.end()}I();function C(){i.listeners(arguments[0]).length>0&&i.emit.apply(i,arguments)}this._close=function(){r!==s.CLOSED&&(r=s.CLOSED,u.abort&&u.abort(),u.xhr&&u.xhr.abort&&u.xhr.abort())};function Z(n,v,c,E){if(E===0){if(U.length>0){var N=G||"message";C(N,new ue(N,{data:U.slice(0,-1),lastEventId:O,origin:new URL(a).origin})),U=""}G=void 0}else if(c>0){var T=c<0,l=0,p=n.slice(v,v+(T?E:c)).toString();T?l=E:n[v+c+1]!==se?l=c+1:l=c+2,v+=l;var _=E-l,t=n.slice(v,v+_).toString();if(p==="data")U+=t+`
`;else if(p==="event")G=t;else if(p==="id")O=t;else if(p==="retry"){var m=parseInt(t,10);Number.isNaN(m)||(i.reconnectInterval=m)}}}}V.exports=s;te.inherits(s,D.EventEmitter);s.prototype.constructor=s;["open","error","message"].forEach(function(a){Object.defineProperty(s.prototype,"on"+a,{get:function(){var r=this.listeners(a)[0];return r?r._listener?r._listener:r:void 0},set:function(r){this.removeAllListeners(a),this.addEventListener(a,r)}})});Object.defineProperty(s,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(s,"OPEN",{enumerable:!0,value:1});Object.defineProperty(s,"CLOSED",{enumerable:!0,value:2});s.prototype.CONNECTING=0;s.prototype.OPEN=1;s.prototype.CLOSED=2;s.prototype.close=function(){this._close()};s.prototype.addEventListener=function(e,r){typeof r=="function"&&(r._listener=r,this.on(e,r))};s.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};s.prototype.removeEventListener=function(e,r){typeof r=="function"&&(r._listener=void 0,this.removeListener(e,r))};function P(a,e){if(Object.defineProperty(this,"type",{writable:!1,value:a,enumerable:!0}),e)for(var r in e)e.hasOwnProperty(r)&&Object.defineProperty(this,r,{writable:!1,value:e[r],enumerable:!0})}function ue(a,e){Object.defineProperty(this,"type",{writable:!1,value:a,enumerable:!0});for(var r in e)e.hasOwnProperty(r)&&Object.defineProperty(this,r,{writable:!1,value:e[r],enumerable:!0})}function ve(a){var e={};for(var r in a)ie.test(r)||(e[r]=a[r]);return e}});var le=Y((de,X)=>{X.exports=W()});export default le();
